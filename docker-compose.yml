# ============================================================
# 104 企業大師自動打卡 - Docker Compose
# ============================================================
#
# 使用方式:
#   docker compose up clock-in   # 上班打卡
#   docker compose up clock-out  # 下班打卡
#
# 搭配 cron 使用:
#   50 8 * * 1-5 cd /path/to/104-auto-clockin && docker compose up clock-in
#   5 18 * * 1-5 cd /path/to/104-auto-clockin && docker compose up clock-out
#
# ============================================================

services:
  # 开发环境
  104-clockin-dev:
    image: mcr.microsoft.com/playwright/python:v1.58.0-noble
    working_dir: /app
    volumes:
      - .:/app
      - /var/run/docker.sock:/var/run/docker.sock
    environment:
      - PRO104_ACCOUNT=${PRO104_ACCOUNT}
      - PRO104_PASSWORD=${PRO104_PASSWORD}
    command: sleep infinity
    env_file:
      - .env
    
  clock-in:
    build: .
    command: ["--action", "clock_in"]
    environment:
      - PRO104_ACCOUNT=${PRO104_ACCOUNT}
      - PRO104_PASSWORD=${PRO104_PASSWORD}
    volumes:
      - ./logs:/app/logs
      - ./screenshots:/app/screenshots
    env_file:
      - .env

  clock-out:
    build: .
    command: ["--action", "clock_out"]
    environment:
      - PRO104_ACCOUNT=${PRO104_ACCOUNT}
      - PRO104_PASSWORD=${PRO104_PASSWORD}
    volumes:
      - ./logs:/app/logs
      - ./screenshots:/app/screenshots
    env_file:
      - .env
